# 第 67 章 计算机图形学中的线性代数

<div class="context-flow" markdown>

**前置**：矩阵运算 (Ch02) · 线性变换 (Ch05) · 四元数矩阵 (Ch51) · 正交性 (Ch07)

**本章脉络**：齐次坐标 (Homogeneous Coordinates) 的引入 $\to$ 平移、旋转、缩放的统一矩阵表示 $\to$ 2D 与 3D 变换矩阵 $\to$ 投影变换：正交投影与透视投影 $\to$ 视图变换与相机模型 $\to$ 重心坐标 (Barycentric Coordinates) 与三角形光栅化 $\to$ 光线追踪中的线性相交方程 $\to$ 着色模型：点积与 Lambert 漫反射 $\to$ 动画插值：LERP 与 SLERP

**延伸**：计算机图形学本质上是线性代数的“实时可视化”；它通过 4x4 矩阵将三维世界的几何形态投影到二维屏幕上，是现代游戏引擎（Unreal, Unity）与影视特效的数学核心

</div>

在计算机屏幕上看到的每一个三维角色或场景，本质上都是数百万次矩阵乘法的结果。为了在统一的框架下处理平移（非线性）与旋转（线性），图形学引入了齐次坐标系。本章将展示如何利用 4x4 矩阵构建出从虚拟世界到像素平面的完整几何路径。

---

## 67.1 齐次坐标与基础变换

!!! definition "定义 67.1 (齐次坐标)"
    为了将平移操作转化为矩阵乘法，将三维向量 $(x, y, z)$ 扩充为四维 $(x, y, z, w)$。通常取 $w=1$。
    - **平移矩阵**：$T(\mathbf{t}) = \begin{pmatrix} 1 & 0 & 0 & t_x \\ 0 & 1 & 0 & t_y \\ 0 & 0 & 1 & t_z \\ 0 & 0 & 0 & 1 \end{pmatrix}$。

!!! technique "变换组合"
    通过矩阵乘法，我们可以将缩放 ($S$)、旋转 ($R$) 和平移 ($T$) 组合成一个单一的变换矩阵 $M = T \cdot R \cdot S$。注意乘法顺序决定了变换的相对参考系。

---

## 67.2 投影变换

!!! definition "定义 67.2 (透视投影矩阵)"
    透视投影模拟了人类视觉“近大远小”的特性。通过设置视锥体参数，其标准矩阵形式如下：
    $$P = \begin{pmatrix} \frac{1}{\tan(\alpha/2)} & 0 & 0 & 0 \\ 0 & \frac{1}{\tan(\alpha/2)} & 0 & 0 \\ 0 & 0 & \frac{f+n}{f-n} & \frac{-2fn}{f-n} \\ 0 & 0 & 1 & 0 \end{pmatrix}$$
    其中最后一行将 $z$ 坐标复制到 $w$ 分量，实现透视除法。

---

## 67.3 重心坐标与光栅化

!!! technique "重心坐标"
    三角形内任意一点 $P$ 可以表示为三个顶点 $A, B, C$ 的线性组合：
    $$P = \alpha A + \beta B + \gamma C, \quad \alpha + \beta + \gamma = 1$$
    **应用**：这是属性插值（如颜色、纹理坐标）和判定点是否在三角形内的核心算法。

---

## 67.4 着色与光照

!!! theorem "定理 67.1 (Lambert 漫反射)"
    物体表面某点的亮度 $I$ 与光源方向 $\mathbf{L}$ 和表面法向量 $\mathbf{N}$ 的点积成正比：
    $$I = I_0 \max(0, \mathbf{N} \cdot \mathbf{L})$$
    这展示了线性代数中的**内积**如何决定了三维世界的阴影与立体感。

---

## 练习题

1. **[基础] 写出绕 $z$ 轴旋转 $\theta$ 角的 2D 齐次变换矩阵。**

   ??? success "参考答案"
       $\begin{pmatrix} \cos\theta & -\sin\theta & 0 \\ \sin\theta & \cos\theta & 0 \\ 0 & 0 & 1 \end{pmatrix}$。

2. **[平移] 计算将点 $(1, 2, 3)$ 平移 $(5, 0, -1)$ 后的齐次坐标。**

   ??? success "参考答案"
       $(1+5, 2+0, 3-1, 1) = (6, 2, 2, 1)$。

3. **[投影] 为什么透视投影矩阵的最后一行通常是 $(0, 0, 1, 0)$？**

   ??? success "参考答案"
       为了将 $z$ 值存储在齐次分量 $w$ 中。在硬件渲染管线中，后续会执行 $x/w, y/w, z/w$ 的归一化操作，从而产生近大远小的透视效果。

4. **[重心坐标] 若某点的重心坐标为 $(0.5, 0.5, 0)$，该点在三角形的什么位置？**

   ??? success "参考答案"
       在该三角形对应于前两个顶点所连边（$AB$ 边）的中点上。

5. **[四元数] 为什么 3D 游戏常用四元数而非 Euler 角表示旋转？**

   ??? success "参考答案"
       避免万向锁（Gimbal Lock），且插值（SLERP）更平滑，计算效率更高。

6. **[光线追踪] 计算射线 $\mathbf{r}(t) = \mathbf{o} + t\mathbf{d}$ 与平面 $\mathbf{n} \cdot \mathbf{p} + d = 0$ 的交点 $t$。**

   ??? success "参考答案"
       代入得 $\mathbf{n} \cdot (\mathbf{o} + t\mathbf{d}) + d = 0 \implies t = \frac{-(d + \mathbf{n} \cdot \mathbf{o})}{\mathbf{n} \cdot \mathbf{d}}$。

7. **[矩阵顺序] 证明：先旋转后平移与先平移后旋转是不等价的。**

   ??? success "参考答案"
       $T \cdot R \neq R \cdot T$。由于矩阵乘法不满足交换律，平移后再旋转会使平移向量也发生旋转。

8. **[法线变换] 为什么变换法向量 $\mathbf{N}$ 时不能直接用模型矩阵 $M$，而要用 $(M^{-1})^T$？**

   ??? success "参考答案"
       为了保持法向量与切平面的正交性。在缩放变换下，直接使用 $M$ 会使法线方向畸变。

9. **[SLERP] 什么是球面线性插值？**

   ??? success "参考答案"
       在两个单位四元数（四维球面的点）之间沿着大圆路径进行的恒定角速度插值。

10. **[应用] 简述 GPU（图形处理器）为什么适合线性代数运算。**

   ??? success "参考答案"
        GPU 拥有数千个并行核心，能够同时对成千上万个顶点执行相同的 4x4 矩阵乘法（SIMD 架构），完美契合图形学的代数需求。

## 本章小结

计算机图形学是线性代数最华丽的舞台：

1.  **维度的升降**：通过齐次坐标，图形学将非线性的几何刚体运动统一为线性的矩阵运算，确立了流水线式渲染的代数基础。
2.  **投影的奥秘**：透视矩阵展示了如何利用线性代数的亏秩倾向（通过 $w$ 分量除法）来模拟高维空间向低维视觉的坍缩，构建了数字世界的深度感。
3.  **几何的逻辑**：从重心坐标的插值到点积的光照计算，图形学证明了现实世界的所有感官体验（颜色、形状、光影）在底层都可以还原为优雅的向量运算。
