# 第 67 章 线性代数在计算机图形学中的应用

<div class="context-flow" markdown>

**前置**：矩阵运算(Ch2) · 线性变换(Ch5) · 正交矩阵(Ch7) · 特征值(Ch6)

**本章脉络**：齐次坐标 → 仿射变换 → 旋转表示(矩阵/四元数/SLERP) → 模型-视图-投影矩阵 → 透视与正交投影 → 视口变换 → 颜色空间变换 → 样条曲面

**延伸**：计算机图形学是应用线性代数的研究高地；GPU 架构本质上是大规模单指令多数据流(SIMD)矩阵乘法加速器

</div>

计算机图形学通过线性空间变换实现三维场景的数字化重构。通过引入齐次坐标，非线性的仿射变换被嵌入到高维线性映射中，从而允许通过统一的矩阵乘法链处理复杂的几何流水线。

---

## 67.1 齐次变换与几何流水线

!!! definition "定义 67.1 (齐次坐标与仿射嵌入)"
    三维欧氏空间中的点 $\mathbf{p} \in \mathbb{R}^3$ 被映射到射影空间中的四元组 $(x, y, z, 1)^T$。这使得平移变换 $T$ 与旋转、缩放一样，被表示为 $GL(4, \mathbb{R})$ 的子群元素。

!!! theorem "定理 67.7 (伴随法向量变换)"
    若顶点经非奇异矩阵 $M$ 变换，则其表面法向量 $\mathbf{n}$ 必须遵循 $(M^{-1})^T$ 的变换规则，以保持法线与切平面的正交性。

---

## 练习题

1. **[矩阵统一性] 解释为什么齐次坐标是实现 GPU 硬件管线标准化处理的基础。**
   ??? success "参考答案"
       齐次坐标将平移（加法）转化为矩阵乘法。这使得旋转、缩放、平移和投影可以级联为一个复合矩阵 $M_{total}$。GPU 硬件只需实现高效的矩阵-向量乘法器即可处理所有几何操作。

2. **[齐次除法] 推导透视投影矩阵中 $w$ 分量的生成逻辑及其在齐次除法（Homogeneous Division）中的作用。**
   ??? success "参考答案"
       透视投影矩阵将 $z$ 信息编码到 $w$ 分量（通常 $w = -z$）。在裁剪之后，所有坐标除以 $w$，实现了 $x/z, y/z$ 的映射，这在几何上等价于相似三角形比例关系，产生了视觉上的透视效应。

3. **[旋转奇异性] 分析 Euler 角表示法在 $\theta = \pm 90^\circ$ 时出现“万向锁”（Gimbal Lock）的数学本质。**
   ??? success "参考答案"
       当俯仰角为 $\pm 90^\circ$ 时，绕 $x$ 轴旋转与绕 $z$ 轴旋转的旋转轴共线。此时旋转矩阵的 Jacobian 矩阵亏秩，系统失去了一个运动自由度，无法在三维空间中描述任意方向的微小转动。

4. **[四元数] 证明单位四元数 $\mathbf{q}$ 与其负值 $-\mathbf{q}$ 描述的是同一个旋转算子。**
   ??? success "参考答案"
       旋转变换为 $\mathbf{p}' = \mathbf{q} \mathbf{p} \mathbf{q}^{-1}$。代入 $-\mathbf{q}$ 得 $(-\mathbf{q}) \mathbf{p} (-\mathbf{q})^{-1} = (-1)^2 \mathbf{q} \mathbf{p} \mathbf{q}^{-1} = \mathbf{p}'$。这说明 $SU(2)$ 是 $SO(3)$ 的二重覆盖。

5. **[插值特性] 证明 SLERP（球面线性插值）公式在单位球面上具有恒定的角速度。**
   ??? success "参考答案"
       SLERP 公式通过 $\frac{\sin((1-t)\theta)}{\sin\theta} q_0 + \frac{\sin(t\theta)}{\sin\theta} q_1$ 进行。通过计算其相对于 $t$ 的一阶导数模长，可以证明其在 $S^3$ 上的弧长演化速率恒定，即 $\frac{d\alpha}{dt} = \text{const}$。

6. **[法向量校正] 计算非均匀缩放矩阵 $S = \operatorname{diag}(2, 1, 1)$ 对法向量 $(1, 1, 0)^T$ 的影响。**
   ??? success "参考答案"
       顶点矩阵 $M=S$。正确法向变换矩阵为 $(M^{-1})^T = \operatorname{diag}(0.5, 1, 1)$。变换后法向量为 $(0.5, 1, 0)^T$。验证：变换后切向量为 $(2, 1, 0)^T$，内积为 $0.5 \cdot 2 + 1 \cdot 1 = 2 \neq 0$？修正：原法向应为垂直于切向 $(1, 1, 0)$ 的 $(1, -1, 0)$。变换后法向 $(0.5, -1, 0)$，切向 $(2, 1, 0)$，内积 $1 - 1 = 0$。

7. **[深度非线性] 分析透视变换后深度值 $z_{ndc}$ 与原始深度 $z_{eye}$ 的倒数关系，及其对 Z-buffer 精度分配的影响。**
   ??? success "参考答案"
       $z_{ndc} = A + B/z_{eye}$。这种双曲关系导致近平面附近的采样密度极大，而远平面附近采样极稀疏。这有利于近处物体的精确遮挡判定，但也导致了远景处的深度冲突（Z-fighting）。

8. **[重心坐标] 证明透视校正插值公式 $a = \frac{\sum a_i \lambda_i / w_i}{\sum \lambda_i / w_i}$ 能够还原三维空间中的属性线性。**
   ??? success "参考答案"
       这源于从三维世界空间到屏幕空间的射影变换不是仿射的。只有通过 $1/w$ 加权，才能将非线性的屏幕坐标系重新映射回线性变化的剪裁空间参数。

9. **[反射与对合] 证明 Householder 反射矩阵 $H = I - 2\mathbf{n}\mathbf{n}^T$ 是对称且正交的，并求其行列式。**
   ??? success "参考答案"
       $H^T = H$ 显见。$H^T H = (I-2\mathbf{n}\mathbf{n}^T)(I-2\mathbf{n}\mathbf{n}^T) = I - 4\mathbf{n}\mathbf{n}^T + 4\mathbf{n}(\mathbf{n}^T\mathbf{n})\mathbf{n}^T = I$。行列式由 $\det(I + uv^T) = 1 + v^T u$ 得 $1 + (-2)\mathbf{n}^T\mathbf{n} = -1$。

10. **[颜色变换] 说明 RGB 空间到 YCbCr 空间的线性变换矩阵中，亮度分量 $Y$ 系数的确定依据。**
    ??? success "参考答案"
        $Y = 0.299R + 0.587G + 0.114B$。系数反映了人类视觉系统（CIE 观察者模型）对不同波长光强度的加权敏感度（绿色最强，蓝色最弱）。

## 本章小结

本章系统论述了线性代数在计算机图形学中的底层支柱作用：

1. **统一表示**：齐次坐标将几何变换统一为 $GL(4, \mathbb{R})$ 矩阵运算，确立了图形流水线的计算标准。
2. **旋转建模**：分析了不同旋转表示的代数特性，证明了四元数在连续运动插值中的优越性。
3. **空间投影**：揭示了透视变换的非线性本质及其在射影几何下的线性实现方式。
4. **属性几何**：确立了法向量变换与透视插值的修正判据，保证了渲染过程中的物理与几何一致性。
