# 第 40A 章 积和式

<div class="context-flow" markdown>

**前置**：行列式 (Ch03) · 双随机矩阵 (Ch31)

**本章脉络**：积和式 (Permanent) 定义 $\to$ 与行列式的形式对比 $\to$ 计算复杂性 (#P-完全性) $\to$ Ryser 算法公式 $\to$ 双随机矩阵的积和式 $\to$ van der Waerden 猜想（定理） $\to$ Minc 猜想（上界） $\to$ 应用：二部图完美匹配计数、统计力学中的二聚体问题

**延伸**：积和式是组合数学中最重要的矩阵函数之一；虽然它在形式上只比行列式少了一个“符号”，但这种差异导致了从多项式时间到指数时间的计算鸿沟

</div>

如果说行列式是线性代数的“体积”，那么**积和式**（Permanent）就是线性代数的“计数器”。它在形式上与行列式惊人地相似，但去掉了排列的符号项。这一微小的改动使得积和式不再具有转置不变性（对非方阵而言）或乘法性质，却成为了解决图论中染色与匹配问题的终极工具。

---

## 40A.1 定义与形式对比

!!! definition "定义 40A.1 (积和式)"
    $n$ 阶方阵 $A$ 的**积和式**定义为：
    $$\operatorname{perm}(A) = \sum_{\sigma \in S_n} a_{1,\sigma(1)} a_{2,\sigma(2)} \cdots a_{n,\sigma(n)}$$
    对比：行列式 $\det(A) = \sum \operatorname{sgn}(\sigma) a_{1,\sigma(1)} \cdots a_{n,\sigma(n)}$。

!!! note "计算复杂性"
    尽管行列式可以在 $O(n^3)$ 时间内求解，但积和式的计算被证明是 **#P-完全**的（Valiant 定理）。这意味着目前不存在已知的多项式时间算法。

---

## 40A.2 van der Waerden 定理

!!! theorem "定理 40A.1 (van der Waerden 定理)"
    对于 $n$ 阶双随机矩阵 $P$（每行每列和为 1，且非负）：
    $$\operatorname{perm}(P) \ge \frac{n!}{n^n}$$
    等号成立当且仅当 $P = J_n/n$（全 1 矩阵的均值）。这一结论揭示了双随机矩阵积和式的下界。

---

## 40A.3 计算公式：Ryser 公式

!!! algorithm "算法 40A.1 (Ryser 公式)"
    为了比直接枚举 $n!$ 个排列更快，Ryser 给出了基于容斥原理的公式：
    $$\operatorname{perm}(A) = (-1)^n \sum_{S \subseteq \{1,\ldots,n\}} (-1)^{|S|} \prod_{i=1}^n \left( \sum_{j \in S} a_{ij} \right)$$
    **复杂度**：$O(n 2^n)$。这仍然是指数级的，但在中等规模下比直接求和快得多。

---

## 练习题

1. **[基础] 计算 $\begin{pmatrix} 1 & 2 \\ 3 & 4 \end{pmatrix}$ 的积和式。**
   ??? success "参考答案"
       $1(4) + 2(3) = 10$。对比行列式为 -2。

2. **[性质] 对于对角阵，其积和式等于什么？**
   ??? success "参考答案"
       等于主对角线元素的乘积。此时积和式与行列式相等。

3. **[二部图] 若 $A$ 是二部图的邻接矩阵（(0,1)-矩阵），$\operatorname{perm}(A)$ 代表什么？**
   ??? success "参考答案"
       代表该二部图的**完美匹配**（Perfect Matching）的总数。

4. **[van der Waerden] 计算 $2 \times 2$ 全 1 均值阵 $J_2/2$ 的积和式，验证下界。**
   ??? success "参考答案"
       $\operatorname{perm} \begin{pmatrix} 0.5 & 0.5 \\ 0.5 & 0.5 \end{pmatrix} = 0.5$。下界 $2!/2^2 = 0.5$。等号成立。

5. **[多重线性] 证明积和式关于矩阵的行是线性的。**
   ??? success "参考答案"
       每一项乘积中仅包含该行的一个元素，求和后仍然保持线性性。

6. **[上界] 若 $A$ 是 (0,1)-矩阵且每行有 $r_i$ 个 1，其积和式的上界（Minc 猜想）是什么？**
   ??? success "参考答案"
       $\operatorname{perm}(A) \le \prod (r_i !)^{1/r_i}$。

7. **[矩阵幂] 两个矩阵积和式的乘积等于乘积矩阵的积和式吗？**
   ??? success "参考答案"
       一般不相等。这是积和式相对于行列式最重要的代数缺失。

8. **[反对称] 证明：对于奇数阶反对称矩阵 $A$，$\det(A)=0$，那么其积和式一定为 0 吗？**
   ??? success "参考答案"
       不一定。例如 $\begin{pmatrix} 0 & 1 \\ -1 & 0 \end{pmatrix}$，$\operatorname{perm} = -1$。

9. **[单位元] 积和式运算在置换矩阵下的性质。**
   ??? success "参考答案"
       $\operatorname{perm}(PAQ) = \operatorname{perm}(A)$ 对任何置换阵 $P, Q$ 成立。

10. **[应用] 为什么在量子光学中积和式非常重要？**
    ??? success "参考答案"
        玻色子系统的符合计数概率（Boson Sampling）直接由对应转移矩阵的积和式给出。

## 本章小结

积和式是连接代数与组合难题的纽带：

1.  **对称性的代价**：去掉了行列式的交错符号后，积和式失去了绝大部分优秀的代数性质（如乘法法则），这直接导致了其计算上的“灾难性”复杂度。
2.  **组合的计数器**：通过将组合约束编码进 (0,1)-矩阵，积和式成为了解决排列、匹配和染色等组合计数问题的万能钥匙。
3.  **分布的界限**：van der Waerden 定理展示了矩阵元素的均衡程度（双随机性）如何严格限制了其拓扑结构的丰富程度（积和式的大小）。
